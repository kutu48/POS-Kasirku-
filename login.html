<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Login Kasir Web</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .toast {
      position: fixed;
      left: 50%;
      bottom: 36px;
      transform: translateX(-50%);
      min-width: 180px;
      padding: 10px 22px;
      border-radius: 10px;
      font-weight: bold;
      text-align: center;
      color: #fff;
      z-index: 9999;
      font-size: 1rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s, bottom 0.5s;
    }
    .toast.show { opacity: 1; pointer-events: auto; }
    .toast-success { background: #22c55e; }
    .toast-error { background: #ef4444; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="w-full max-w-sm bg-white rounded-2xl shadow-lg p-8">
    <h2 class="text-2xl font-bold text-blue-700 text-center mb-4">KasirKu Login</h2>
    <form id="formLogin" class="flex flex-col gap-3">
      <label class="font-semibold">Username
        <input id="username" type="text" class="border px-3 py-2 rounded-lg w-full mt-1" required autocomplete="username">
      </label>
      <label class="font-semibold">Password
        <input id="password" type="password" class="border px-3 py-2 rounded-lg w-full mt-1" required autocomplete="current-password">
      </label>
      <label class="flex items-center gap-2 mt-1 mb-2">
        <input type="checkbox" id="saveUser" class="accent-blue-600 rounded">
        <span class="text-sm">Simpan username</span>
      </label>
      <button type="submit" class="bg-blue-600 hover:bg-blue-800 text-white font-bold py-2 rounded-lg shadow">Login</button>
    </form>
    <div id="errorMsg" class="text-red-600 mt-3 text-sm text-center hidden"></div>
  </div>
  <div id="toast" class="toast"></div>

<script>
  // Ganti dengan URL Apps Script endpoint kamu!
  const apiLogin = "https://script.google.com/macros/s/AKfycbwnybCYTWvoJvugHz9ywLF217Gy/exec?route=login";

  // Notifikasi toast
  function showToast(msg, tipe="success") {
    var t = document.getElementById('toast');
    t.textContent = msg;
    t.className = "toast toast-" + tipe + " show";
    setTimeout(function() {
      t.className = "toast toast-" + tipe;
    }, 2700);
  }

  // Ambil username tersimpan (jika ada)
  window.onload = function() {
    var saved = localStorage.getItem('kasirweb_username');
    if (saved) {
      document.getElementById('username').value = saved;
      document.getElementById('saveUser').checked = true;
      setTimeout(()=>document.getElementById('password').focus(),100);
    }
  }

  document.getElementById('formLogin').onsubmit = function(e) {
    e.preventDefault();
    document.getElementById('errorMsg').classList.add('hidden');
    var username = document.getElementById('username').value.trim();
    var password = document.getElementById('password').value;
    var saveUser = document.getElementById('saveUser').checked;
    var btn = this.querySelector('button[type="submit"]');
    btn.disabled = true; btn.textContent = "Loading...";

    // Simpan username jika dipilih
    if (saveUser) {
      localStorage.setItem('kasirweb_username', username);
    } else {
      localStorage.removeItem('kasirweb_username');
    }

    fetch(apiLogin, {
      method: "POST",
      body: JSON.stringify({username: username, password: password})
    })
    .then(function(res) { return res.json(); })
    .then(function(result) {
      if (result.success) {
        localStorage.setItem("kasirweb_user", JSON.stringify(result));
        showToast("Login sukses!", "success");
        setTimeout(function() {
          if (window.android_loginSuccess) {
            window.android_loginSuccess();
          } else {
            // Fallback redirect, kalau tidak dari Android
            window.location.href = "index.html";
          }
        }, 1200);
      } else {
        showToast(result.msg || "Login gagal!", "error");
        document.getElementById('errorMsg').textContent = result.msg || "Login gagal!";
        document.getElementById('errorMsg').classList.remove('hidden');
      }
      btn.disabled = false; btn.textContent = "Login";
    })
    .catch(function(err) {
      showToast("Gagal koneksi server!", "error");
      document.getElementById('errorMsg').textContent = "Gagal koneksi server!";
      document.getElementById('errorMsg').classList.remove('hidden');
      btn.disabled = false; btn.textContent = "Login";
    });
  }
</script>
</body>
</html>
